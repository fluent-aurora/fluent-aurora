<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:ui="using:FluentAvalonia.UI.Controls"
             xmlns:ic="using:FluentIcons.Avalonia.Fluent"
             xmlns:vm="using:FluentAurora.ViewModels"
             xmlns:converters="using:FluentAurora.Converters"
             xmlns:controls="using:FluentAurora.Controls"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="100"
             x:Class="FluentAurora.Controls.PlaybackControl">
    <UserControl.Resources>
        <converters:PositionToTimeConverter x:Key="TimeConverter" />
    </UserControl.Resources>
    <Design.DataContext>
        <vm:PlaybackControlViewModel />
    </Design.DataContext>
    <Border Background="{DynamicResource SolidBackgroundFillColorBaseBrush}"
            BorderThickness="0,1,0,0"
            BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}">
        <Grid ColumnDefinitions="*,Auto,*" Margin="20,10">
            <!-- Track Info -->
            <Grid Grid.Column="0" ColumnDefinitions="Auto,*">
                <Border Width="60"
                        Height="60"
                        CornerRadius="4"
                        Background="#FF2D2D2D"
                        Margin="0,0,15,0">
                    <Grid>
                        <!-- Placeholder icon (No Artwork) -->
                        <ic:SymbolIcon Symbol="MusicNote2"
                                       FontSize="20"
                                       Opacity="0.3"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       IsVisible="{Binding SongArtwork, Converter={x:Static ObjectConverters.IsNull}}" />

                        <!-- Artwork -->
                        <Image Source="{Binding SongArtwork}"
                               Stretch="UniformToFill" />
                    </Grid>
                </Border>
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <controls:ScrollingTextBlock Text="{Binding SongTitle, FallbackValue='No Track Playing'}"
                                                 ShowToolTip="True"
                                                 FontWeight="SemiBold"
                                                 FontSize="14"
                                                 PauseBeforeScroll="2000"
                                                 ScrollSpeed="30"
                                                 ScrollGap="50" />

                    <controls:ScrollingTextBlock Text="{Binding SongArtist, FallbackValue='Unknown Artist'}"
                                                 ShowToolTip="True"
                                                 Opacity="0.7"
                                                 FontSize="12"
                                                 PauseBeforeScroll="2000"
                                                 ScrollSpeed="25"
                                                 ScrollGap="50" />
                </StackPanel>
            </Grid>

            <!-- Playback Buttons -->
            <Grid Grid.Column="1"
                  MinWidth="500"
                  VerticalAlignment="Center"
                  HorizontalAlignment="Center">
                <StackPanel HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Orientation="Vertical">
                    <!-- Button row -->
                    <StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Center"
                                Spacing="12">
                        <Button Command="{Binding OpenFileCommand}"
                                Width="40"
                                Height="32"
                                ToolTip.Tip="Open File"
                                AutomationProperties.Name="Open File">
                            <ic:SymbolIcon Symbol="FolderOpen" FontSize="16" />
                        </Button>

                        <!-- Shuffle Button -->
                        <Button Width="40"
                                Height="32"
                                ToolTip.Tip="Shuffle">
                            <ic:SymbolIcon Symbol="ArrowShuffle" FontSize="16" />
                        </Button>

                        <!-- Previous -->
                        <Button Width="40"
                                Height="32"
                                ToolTip.Tip="Previous Track">
                            <ic:SymbolIcon Symbol="Previous" FontSize="16" />
                        </Button>

                        <!-- Play/Pause -->
                        <Button Command="{Binding TogglePlayCommand}"
                                Width="44"
                                Height="40"
                                CornerRadius="20">
                            <ic:SymbolIcon Symbol="{Binding PlayPauseIcon}" FontSize="18" />
                        </Button>

                        <!-- Next -->
                        <Button Width="40"
                                Height="32"
                                ToolTip.Tip="Next Track">
                            <ic:SymbolIcon Symbol="Next" FontSize="16" />
                        </Button>

                        <!-- Repeat -->
                        <Button Width="40"
                                Height="32"
                                Command="{Binding ToggleRepeatCommand}"
                                ToolTip.Tip="Toggle Repeat Mode">
                            <ic:SymbolIcon Symbol="{Binding RepeatIcon}" FontSize="16" />
                        </Button>

                        <!-- Expand Button -->
                        <Button Command="{Binding ToggleExpandCommand}"
                                Width="40"
                                Height="32"
                                ToolTip.Tip="Expand Player">
                            <ic:SymbolIcon Symbol="ChevronUp" FontSize="16" />
                        </Button>
                    </StackPanel>

                    <!-- Progress slider with time indicators -->
                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="8" Width="400">
                        <TextBlock Grid.Column="0"
                                   FontSize="11"
                                   FontWeight="Medium"
                                   Opacity="0.8"
                                   VerticalAlignment="Center"
                                   MinWidth="35"
                                   Text="{Binding DisplayPosition, Converter={x:Static converters:PositionToTimeConverter.Instance}}" />

                        <Slider Grid.Column="1"
                                x:Name="ProgressSlider"
                                Minimum="0"
                                Maximum="{Binding SongDuration}"
                                Value="{Binding DisplayPosition, Mode=TwoWay}"
                                UseLayoutRounding="False"
                                VerticalAlignment="Center">
                            <ToolTip.Tip>
                                <StackPanel>
                                    <TextBlock Text="{Binding DisplayPosition, Converter={x:Static converters:PositionToTimeConverter.Instance}}"
                                               FontWeight="SemiBold" />
                                    <TextBlock Text="Click or drag to seek"
                                               FontSize="11"
                                               Opacity="0.7" />
                                </StackPanel>
                            </ToolTip.Tip>
                        </Slider>

                        <TextBlock Grid.Column="2"
                                   FontSize="11"
                                   FontWeight="Medium"
                                   Opacity="0.8"
                                   VerticalAlignment="Center"
                                   MinWidth="35"
                                   Text="{Binding SongDuration, Converter={x:Static converters:PositionToTimeConverter.Instance}}" />
                    </Grid>
                </StackPanel>
            </Grid>

            <!-- Volume and Secondary Controls -->
            <Grid Grid.Column="2"
                  MinWidth="200"
                  HorizontalAlignment="Right"
                  VerticalAlignment="Center"
                  ColumnDefinitions="Auto,*"
                  ColumnSpacing="8">

                <!-- Secondary Controls -->
                <StackPanel Grid.Column="0"
                            Orientation="Horizontal"
                            Spacing="8">
                    <Button Width="40"
                            Height="32"
                            ToolTip.Tip="Show Playlist">
                        <ic:SymbolIcon Symbol="List" FontSize="16" />
                    </Button>
                    <Button Width="40"
                            Height="32"
                            ToolTip.Tip="Mute/Unmute">
                        <ic:SymbolIcon Symbol="{Binding VolumeIcon}" FontSize="16" />
                    </Button>
                </StackPanel>

                <!-- Volume Control -->
                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            Spacing="4">

                    <Slider Width="80"
                            Minimum="0"
                            Maximum="100"
                            Value="{Binding CurrentVolume}"
                            VerticalAlignment="Center">
                        <ToolTip.Tip>
                            <TextBlock>
                                <TextBlock.Text>
                                    <MultiBinding StringFormat="Volume: {0}%">
                                        <Binding Path="CurrentVolume" />
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>
                        </ToolTip.Tip>
                    </Slider>

                    <TextBlock FontSize="11"
                               MinWidth="28"
                               Opacity="0.7"
                               VerticalAlignment="Center"
                               Text="{Binding CurrentVolume, StringFormat='{}{0}%'}" />
                </StackPanel>
            </Grid>
        </Grid>
    </Border>
</UserControl>