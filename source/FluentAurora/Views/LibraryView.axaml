<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:fa="using:FluentAvalonia.UI.Controls"
             xmlns:ic="using:FluentIcons.Avalonia.Fluent"
             xmlns:converters="using:FluentAurora.Converters"
             xmlns:vm="using:FluentAurora.ViewModels"
             xmlns:controls="clr-namespace:FluentAurora.Controls"
             mc:Ignorable="d"
             x:Class="FluentAurora.Views.LibraryView"
             x:Name="LibraryRoot"
             d:DesignWidth="1000"
             d:DesignHeight="600"
             Padding="16">

    <Design.DataContext>
        <vm:LibraryViewModel />
    </Design.DataContext>

    <UserControl.Resources>
        <converters:PositionToTimeConverter x:Key="TimeConverter" />
        <SolidColorBrush x:Key="HoverBrush" Color="#22FFFFFF" />
        <SolidColorBrush x:Key="SongCardBackground" Color="#1AFFFFFF" />
    </UserControl.Resources>

    <UserControl.Styles>
        <!-- Playlist Header -->
        <Style Selector="TextBlock.playlist-header">
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="FontSize" Value="16" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <!-- Song Title -->
        <Style Selector="TextBlock.song-title">
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="TextTrimming" Value="CharacterEllipsis" />
        </Style>

        <!-- Song Artist -->
        <Style Selector="TextBlock.song-artist">
            <Setter Property="FontSize" Value="12" />
            <Setter Property="Opacity" Value="0.7" />
            <Setter Property="TextTrimming" Value="CharacterEllipsis" />
        </Style>

        <!-- Song Duration -->
        <Style Selector="TextBlock.song-duration">
            <Setter Property="FontSize" Value="12" />
            <Setter Property="Opacity" Value="0.6" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <!-- Hover effect for songs -->
        <Style Selector="Border.song-item:pointerover">
            <Setter Property="Background" Value="{StaticResource HoverBrush}" />
        </Style>

        <!-- Toggle Button Style -->
        <Style Selector="ToggleButton.view-toggle">
            <Setter Property="MinWidth" Value="140" />
            <Setter Property="Padding" Value="12,6" />
            <Setter Property="CornerRadius" Value="6" />
        </Style>
    </UserControl.Styles>

    <Grid>
        <Grid RowDefinitions="Auto,Auto,*" RowSpacing="10">

            <!-- Top Bar -->
            <Border Grid.Row="0"
                    Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                    CornerRadius="16"
                    Padding="20"
                    Margin="0,0,0,16"
                    IsVisible="{Binding !!Folders.Count}"
                    BoxShadow="0 2 8 #11000000">
                <Grid ColumnDefinitions="Auto,*,Auto">
                    <!-- Left Actions -->
                    <StackPanel Grid.Column="0"
                                Orientation="Horizontal"
                                Spacing="10">
                        <!-- Add Folder Primary Button with Gradient -->
                        <Button Command="{Binding AddFolderCommand}"
                                VerticalAlignment="Center"
                                Height="44"
                                MinWidth="180"
                                Padding="18,0"
                                IsEnabled="{Binding !IsIndexing}">
                            <Button.Styles>
                                <Style Selector="Button">
                                    <Setter Property="Background">
                                        <Setter.Value>
                                            <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                                                <GradientStop Color="#FF7C3AED" Offset="0" />
                                                <GradientStop Color="#FF9F67FF" Offset="1" />
                                            </LinearGradientBrush>
                                        </Setter.Value>
                                    </Setter>
                                    <Setter Property="Foreground" Value="White" />
                                    <Setter Property="FontWeight" Value="SemiBold" />
                                    <Setter Property="CornerRadius" Value="10" />
                                    <Setter Property="BorderThickness" Value="0" />
                                </Style>
                                <Style Selector="Button:pointerover /template/ ContentPresenter">
                                    <Setter Property="Background">
                                        <Setter.Value>
                                            <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                                                <GradientStop Color="#FF8B4BFD" Offset="0" />
                                                <GradientStop Color="#FFAF77FF" Offset="1" />
                                            </LinearGradientBrush>
                                        </Setter.Value>
                                    </Setter>
                                    <Setter Property="RenderTransform" Value="scale(1.02)" />
                                </Style>
                                <Style Selector="Button:pressed /template/ ContentPresenter">
                                    <Setter Property="RenderTransform" Value="scale(0.98)" />
                                </Style>
                                <Style Selector="Button:disabled">
                                    <Setter Property="Opacity" Value="0.4" />
                                </Style>
                            </Button.Styles>
                            <Button.RenderTransform>
                                <ScaleTransform />
                            </Button.RenderTransform>
                            <Button.Transitions>
                                <Transitions>
                                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.15" />
                                </Transitions>
                            </Button.Transitions>
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <ic:SymbolIcon Symbol="FolderAdd" FontSize="20" />
                                <TextBlock Text="Add Music Folder"
                                           VerticalAlignment="Center"
                                           FontSize="14" />
                            </StackPanel>
                        </Button>

                        <!-- Open File Button -->
                        <Button Command="{Binding OpenFileCommand}"
                                Width="44"
                                Height="44"
                                Padding="0"
                                CornerRadius="10"
                                ToolTip.Tip="Open Audio File"
                                Background="{DynamicResource ControlFillColorDefaultBrush}">
                            <Button.Styles>
                                <Style Selector="Button:pointerover /template/ ContentPresenter">
                                    <Setter Property="Background" Value="{DynamicResource ControlFillColorSecondaryBrush}" />
                                    <Setter Property="RenderTransform" Value="scale(1.05)" />
                                </Style>
                                <Style Selector="Button:pressed /template/ ContentPresenter">
                                    <Setter Property="RenderTransform" Value="scale(0.95)" />
                                </Style>
                            </Button.Styles>
                            <Button.RenderTransform>
                                <ScaleTransform />
                            </Button.RenderTransform>
                            <Button.Transitions>
                                <Transitions>
                                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.15" />
                                </Transitions>
                            </Button.Transitions>
                            <ic:SymbolIcon Symbol="FolderOpen" FontSize="20" />
                        </Button>
                    </StackPanel>

                    <!-- Right Actions -->
                    <StackPanel Grid.Column="2"
                                Orientation="Horizontal"
                                Spacing="10">
                        <!-- View Mode Toggle Group -->
                        <Border Background="{DynamicResource ControlFillColorDefaultBrush}"
                                CornerRadius="12"
                                Padding="6"
                                BoxShadow="0 1 4 #08000000">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <!-- Folders View -->
                                <ToggleButton IsChecked="{Binding ShowFolders, Mode=TwoWay}"
                                              ToolTip.Tip="Folders View"
                                              Width="40"
                                              Height="36"
                                              Padding="0"
                                              CornerRadius="8">
                                    <ToggleButton.Styles>
                                        <Style Selector="ToggleButton">
                                            <Setter Property="Background" Value="Transparent" />
                                            <Setter Property="BorderThickness" Value="0" />
                                        </Style>
                                        <Style Selector="ToggleButton:checked">
                                            <Setter Property="Background">
                                                <Setter.Value>
                                                    <SolidColorBrush Color="{DynamicResource SystemAccentColor}" />
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                        <Style Selector="ToggleButton:checked ic|SymbolIcon">
                                            <Setter Property="Foreground" Value="White" />
                                        </Style>
                                        <Style Selector="ToggleButton:pointerover:not(:checked) /template/ ContentPresenter">
                                            <Setter Property="Background" Value="{DynamicResource ControlFillColorSecondaryBrush}" />
                                        </Style>
                                        <Style Selector="ToggleButton:checked:pointerover /template/ ContentPresenter">
                                            <Setter Property="Background" Value="{DynamicResource SystemAccentColorLight1}" />
                                        </Style>
                                    </ToggleButton.Styles>
                                    <ic:SymbolIcon Symbol="Folder" FontSize="18" Opacity="0.9" />
                                </ToggleButton>

                                <!-- All Songs View -->
                                <ToggleButton IsChecked="{Binding ShowAllSongs, Mode=TwoWay}"
                                              ToolTip.Tip="All Songs"
                                              Width="40"
                                              Height="36"
                                              Padding="0"
                                              CornerRadius="8">
                                    <ToggleButton.Styles>
                                        <Style Selector="ToggleButton">
                                            <Setter Property="Background" Value="Transparent" />
                                            <Setter Property="BorderThickness" Value="0" />
                                        </Style>
                                        <Style Selector="ToggleButton:checked">
                                            <Setter Property="Background">
                                                <Setter.Value>
                                                    <SolidColorBrush Color="{DynamicResource SystemAccentColor}" />
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                        <Style Selector="ToggleButton:checked ic|SymbolIcon">
                                            <Setter Property="Foreground" Value="White" />
                                        </Style>
                                        <Style Selector="ToggleButton:pointerover:not(:checked) /template/ ContentPresenter">
                                            <Setter Property="Background" Value="{DynamicResource ControlFillColorSecondaryBrush}" />
                                        </Style>
                                        <Style Selector="ToggleButton:checked:pointerover /template/ ContentPresenter">
                                            <Setter Property="Background" Value="{DynamicResource SystemAccentColorLight1}" />
                                        </Style>
                                    </ToggleButton.Styles>
                                    <ic:SymbolIcon Symbol="MusicNote2" FontSize="18" Opacity="0.9" />
                                </ToggleButton>

                                <!-- Playlists View -->
                                <ToggleButton IsChecked="{Binding ShowPlaylists, Mode=TwoWay}"
                                              ToolTip.Tip="Playlists"
                                              Width="40"
                                              Height="36"
                                              Padding="0"
                                              CornerRadius="8">
                                    <ToggleButton.Styles>
                                        <Style Selector="ToggleButton">
                                            <Setter Property="Background" Value="Transparent" />
                                            <Setter Property="BorderThickness" Value="0" />
                                        </Style>
                                        <Style Selector="ToggleButton:checked">
                                            <Setter Property="Background">
                                                <Setter.Value>
                                                    <SolidColorBrush Color="{DynamicResource SystemAccentColor}" />
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                        <Style Selector="ToggleButton:checked ic|SymbolIcon">
                                            <Setter Property="Foreground" Value="White" />
                                        </Style>
                                        <Style Selector="ToggleButton:pointerover:not(:checked) /template/ ContentPresenter">
                                            <Setter Property="Background" Value="{DynamicResource ControlFillColorSecondaryBrush}" />
                                        </Style>
                                        <Style Selector="ToggleButton:checked:pointerover /template/ ContentPresenter">
                                            <Setter Property="Background" Value="{DynamicResource SystemAccentColorLight1}" />
                                        </Style>
                                    </ToggleButton.Styles>
                                    <ic:SymbolIcon Symbol="List" FontSize="18" Opacity="0.9" />
                                </ToggleButton>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Indexing Progress -->
            <Border Grid.Row="1"
                    IsVisible="{Binding IsIndexing}"
                    Background="#1AFFFFFF"
                    CornerRadius="8"
                    Padding="16,12"
                    Margin="0,0,0,8"
                    HorizontalAlignment="Center">
                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                    <!-- Loading Icon -->
                    <fa:ProgressRing Grid.Column="0"
                                     Foreground="Orange"
                                     Width="24"
                                     Height="24"
                                     IsIndeterminate="True"
                                     VerticalAlignment="Center" />

                    <!-- Progress Text -->
                    <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="4">
                        <TextBlock FontWeight="SemiBold" FontSize="14">
                            <Run Text="Indexing folder: " />
                            <Run Text="{Binding IndexingFolderName}" />
                        </TextBlock>
                        <TextBlock FontSize="12" Opacity="0.8">
                            <Run Text="Added " />
                            <Run Text="{Binding SongsIndexed}" />
                            <Run Text=" of " />
                            <Run Text="{Binding TotalSongsToIndex}" />
                            <Run Text=" songs" />
                        </TextBlock>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Content Area -->
            <Grid Grid.Row="2">
                <!-- Folders View -->
                <Grid IsVisible="{Binding ShowFolders}"
                      RowDefinitions="Auto,*">
                    <Grid.Transitions>
                        <Transitions>
                            <DoubleTransition Property="Opacity" Duration="0:0:0.3" />
                            <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.3" Easing="CubicEaseOut" />
                        </Transitions>
                    </Grid.Transitions>
                    <Grid.Styles>
                        <Style Selector="Grid">
                            <Setter Property="Opacity" Value="0" />
                            <Setter Property="RenderTransform" Value="translateY(20px)" />
                        </Style>
                        <Style Selector="Grid[IsVisible=true]">
                            <Setter Property="Opacity" Value="1" />
                            <Setter Property="RenderTransform" Value="translateY(0px)" />
                        </Style>
                    </Grid.Styles>

                    <!-- Folders Header with Statistics -->
                    <Border Grid.Row="0"
                            Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                            CornerRadius="10"
                            Padding="14"
                            Margin="0,8,0,12"
                            IsVisible="{Binding !!Folders.Count}">
                        <DockPanel LastChildFill="False">
                            <StackPanel DockPanel.Dock="Left" Orientation="Horizontal" Spacing="12">
                                <TextBlock Text="Music Folders" Classes="playlist-header" />

                                <!-- Folders Statistics Badge -->
                                <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                        CornerRadius="12"
                                        Padding="12,6"
                                        VerticalAlignment="Center">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <Border Width="24" Height="24"
                                                CornerRadius="12"
                                                Background="#2260A5FA"
                                                VerticalAlignment="Center">
                                            <ic:SymbolIcon Symbol="Folder"
                                                           FontSize="12"
                                                           Foreground="#FF60A5FA"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center" />
                                        </Border>
                                        <TextBlock VerticalAlignment="Center" FontSize="13">
                                            <Run Text="{Binding Folders.Count}" FontWeight="Bold" />
                                            <Run Text="folders" />
                                        </TextBlock>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </DockPanel>
                    </Border>

                    <ScrollViewer Grid.Row="1"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled">
                        <Grid>
                            <!-- Empty State -->
                            <Border IsVisible="{Binding !Folders.Count}"
                                    Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                                    CornerRadius="12"
                                    Padding="48"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    MaxWidth="400">
                                <StackPanel Spacing="16" HorizontalAlignment="Center">
                                    <!-- Icon -->
                                    <ic:SymbolIcon Symbol="MusicNote2"
                                                   FontSize="64"
                                                   Opacity="0.3"
                                                   HorizontalAlignment="Center" />

                                    <!-- Title -->
                                    <TextBlock Text="No Music Folders"
                                               FontSize="20"
                                               FontWeight="SemiBold"
                                               HorizontalAlignment="Center" />

                                    <!-- Description -->
                                    <TextBlock Text="Get started by adding a folder containing your music files"
                                               FontSize="14"
                                               Opacity="0.7"
                                               TextWrapping="Wrap"
                                               TextAlignment="Center"
                                               HorizontalAlignment="Center" />

                                    <!-- Action Button -->
                                    <Button Command="{Binding AddFolderCommand}"
                                            HorizontalAlignment="Center"
                                            Padding="16,8"
                                            Background="{DynamicResource AccentButtonBackground}"
                                            Foreground="{DynamicResource AccentButtonForeground}"
                                            CornerRadius="6"
                                            IsEnabled="{Binding !IsIndexing}">
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <ic:SymbolIcon Symbol="FolderAdd" FontSize="18" />
                                            <TextBlock Text="Add Music Folder"
                                                       VerticalAlignment="Center"
                                                       FontWeight="SemiBold" />
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                            </Border>

                            <ItemsControl ItemsSource="{Binding Folders}"
                                          IsVisible="{Binding !!Folders.Count}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <!-- Folder Card -->
                                        <Border CornerRadius="10"
                                                Padding="14"
                                                Margin="0,0,0,16"
                                                BoxShadow="0 2 6 #33000000">
                                            <Expander IsExpanded="{Binding IsExpanded, Mode=TwoWay}">
                                                <!-- Folder Header -->
                                                <Expander.Header>
                                                    <DockPanel LastChildFill="False">
                                                        <StackPanel DockPanel.Dock="Left" Orientation="Horizontal" Spacing="10">
                                                            <TextBlock Text="{Binding Name}" Classes="playlist-header">
                                                                <ToolTip.Tip>
                                                                    <TextBlock Text="{Binding Path}" />
                                                                </ToolTip.Tip>
                                                            </TextBlock>
                                                            <TextBlock Text="{Binding SongCount, StringFormat='{}{0} songs'}"
                                                                       FontSize="12"
                                                                       Opacity="0.7"
                                                                       VerticalAlignment="Center" />
                                                        </StackPanel>

                                                        <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" Spacing="8">
                                                            <Button Command="{Binding DataContext.PlayFolderCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                    CommandParameter="{Binding}" ToolTip.Tip="Play All">
                                                                <ic:SymbolIcon Symbol="Play" />
                                                            </Button>
                                                            <Button Command="{Binding DataContext.PlayFolderShuffledCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                    CommandParameter="{Binding}" ToolTip.Tip="Play All (Shuffled)">
                                                                <ic:SymbolIcon Symbol="ArrowShuffle" />
                                                            </Button>
                                                            <Button Command="{Binding DataContext.DeleteFolderCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                    CommandParameter="{Binding}" ToolTip.Tip="Delete Folder">
                                                                <ic:SymbolIcon Symbol="Delete" />
                                                            </Button>
                                                        </StackPanel>
                                                    </DockPanel>
                                                </Expander.Header>

                                                <!-- Songs List -->
                                                <ItemsControl ItemsSource="{Binding Songs}" Margin="0,8,0,0">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <VirtualizingStackPanel />
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>

                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <!-- Song Card -->
                                                            <Border Padding="8,6"
                                                                    Margin="0,2"
                                                                    CornerRadius="6"
                                                                    Background="{StaticResource SongCardBackground}"
                                                                    Classes="song-item"
                                                                    Cursor="Hand"
                                                                    Tapped="SongElement_OnTapped">
                                                                <Border.ContextFlyout>
                                                                    <MenuFlyout>
                                                                        <MenuItem Header="Play"
                                                                                  Command="{Binding DataContext.PlaySongCommand, ElementName=LibraryRoot}"
                                                                                  CommandParameter="{Binding}">
                                                                            <MenuItem.Icon>
                                                                                <ic:SymbolIcon Symbol="Play" />
                                                                            </MenuItem.Icon>
                                                                        </MenuItem>

                                                                        <MenuItem Header="Add to Queue"
                                                                                  Command="{Binding DataContext.EnqueueSongCommand, ElementName=LibraryRoot}"
                                                                                  CommandParameter="{Binding}">
                                                                            <MenuItem.Icon>
                                                                                <ic:SymbolIcon Symbol="Add" />
                                                                            </MenuItem.Icon>
                                                                        </MenuItem>

                                                                        <Separator />

                                                                        <MenuItem Header="Add to Playlist"
                                                                                  Command="{Binding DataContext.AddSongToPlaylistCommand, ElementName=LibraryRoot}"
                                                                                  CommandParameter="{Binding}">
                                                                            <MenuItem.Icon>
                                                                                <ic:SymbolIcon Symbol="List" />
                                                                            </MenuItem.Icon>
                                                                        </MenuItem>

                                                                        <MenuItem Header="Create Playlist with Song"
                                                                                  Command="{Binding DataContext.CreatePlaylistWithSongCommand, ElementName=LibraryRoot}"
                                                                                  CommandParameter="{Binding}">
                                                                            <MenuItem.Icon>
                                                                                <ic:SymbolIcon Symbol="AlbumAdd" />
                                                                            </MenuItem.Icon>
                                                                        </MenuItem>

                                                                        <Separator />

                                                                        <MenuItem Header="Remove from Library"
                                                                                  Command="{Binding DataContext.RemoveSongCommand, ElementName=LibraryRoot}"
                                                                                  CommandParameter="{Binding}">
                                                                            <MenuItem.Icon>
                                                                                <ic:SymbolIcon Symbol="Delete" Foreground="Red" />
                                                                            </MenuItem.Icon>
                                                                        </MenuItem>
                                                                    </MenuFlyout>
                                                                </Border.ContextFlyout>

                                                                <Grid ColumnDefinitions="Auto,*,Auto" Background="Transparent">
                                                                    <!-- Music Icon -->
                                                                    <Border Width="32" Height="32"
                                                                            CornerRadius="4"
                                                                            Background="#FF2D2D2D"
                                                                            Margin="0,0,12,0">
                                                                        <ic:SymbolIcon Symbol="MusicNote2"
                                                                                       FontSize="16"
                                                                                       Opacity="0.5"
                                                                                       HorizontalAlignment="Center"
                                                                                       VerticalAlignment="Center" />
                                                                    </Border>

                                                                    <!-- Title / Artist -->
                                                                    <StackPanel Grid.Column="1"
                                                                                Orientation="Vertical"
                                                                                VerticalAlignment="Center"
                                                                                Margin="0,0,8,0">
                                                                        <ToolTip.Tip>
                                                                            <TextBlock Text="{Binding FilePath}" />
                                                                        </ToolTip.Tip>
                                                                        <TextBlock Text="{Binding Title}" Classes="song-title" />
                                                                        <TextBlock Text="{Binding Artist}" Classes="song-artist" />
                                                                    </StackPanel>

                                                                    <!-- Duration -->
                                                                    <TextBlock Grid.Column="2"
                                                                               Text="{Binding Duration, Converter={StaticResource TimeConverter}}"
                                                                               Classes="song-duration" />
                                                                </Grid>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </Expander>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Grid>
                    </ScrollViewer>
                </Grid>

                <!-- All Songs View -->
                <Grid IsVisible="{Binding ShowAllSongs}"
                      RowDefinitions="Auto,*">
                    <Grid.Transitions>
                        <Transitions>
                            <DoubleTransition Property="Opacity" Duration="0:0:0.3" />
                            <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.3" Easing="CubicEaseOut" />
                        </Transitions>
                    </Grid.Transitions>
                    <Grid.Styles>
                        <Style Selector="Grid">
                            <Setter Property="Opacity" Value="0" />
                            <Setter Property="RenderTransform" Value="translateY(20px)" />
                        </Style>
                        <Style Selector="Grid[IsVisible=true]">
                            <Setter Property="Opacity" Value="1" />
                            <Setter Property="RenderTransform" Value="translateY(0px)" />
                        </Style>
                    </Grid.Styles>

                    <!-- All Songs Header -->
                    <Border Grid.Row="0"
                            Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                            CornerRadius="10"
                            Padding="14"
                            Margin="0,8,0,12">
                        <Grid RowDefinitions="Auto,Auto" RowSpacing="12">
                            <!-- Title and Actions Row -->
                            <DockPanel Grid.Row="0" LastChildFill="False">
                                <StackPanel DockPanel.Dock="Left" Orientation="Horizontal" Spacing="12">
                                    <TextBlock Text="All Songs" Classes="playlist-header" />

                                    <!-- Songs Statistics Badge -->
                                    <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                            CornerRadius="12"
                                            Padding="12,6"
                                            VerticalAlignment="Center">
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <Border Width="24" Height="24"
                                                    CornerRadius="12"
                                                    Background="#22A78BFA"
                                                    VerticalAlignment="Center">
                                                <ic:SymbolIcon Symbol="MusicNote2"
                                                               FontSize="12"
                                                               Foreground="#FFA78BFA"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center" />
                                            </Border>
                                            <TextBlock VerticalAlignment="Center" FontSize="13">
                                                <Run Text="{Binding DisplayedSongs.Count}" FontWeight="Bold" />
                                                <Run Text="displayed" />
                                                <Run Text="{Binding TotalSongCount, StringFormat='of {0}'}" />
                                                <Run Text="songs" />
                                            </TextBlock>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>

                                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" Spacing="8">
                                    <Button Command="{Binding PlayAllSongsCommand}"
                                            ToolTip.Tip="Play All"
                                            IsEnabled="{Binding !IsLoadingSongs}">
                                        <ic:SymbolIcon Symbol="Play" />
                                    </Button>
                                    <Button Command="{Binding PlayAllSongsShuffledCommand}"
                                            ToolTip.Tip="Play All (Shuffled)"
                                            IsEnabled="{Binding !IsLoadingSongs}">
                                        <ic:SymbolIcon Symbol="ArrowShuffle" />
                                    </Button>
                                </StackPanel>
                            </DockPanel>

                            <!-- Search Box Row -->
                            <Border Grid.Row="1"
                                    Background="{DynamicResource ControlFillColorDefaultBrush}"
                                    CornerRadius="6"
                                    Padding="10,6">
                                <Grid ColumnDefinitions="Auto,*,Auto">
                                    <!-- Search Icon or Loading -->
                                    <Panel Grid.Column="0" Margin="0,0,8,0">
                                        <ic:SymbolIcon Symbol="Search"
                                                       FontSize="16"
                                                       Opacity="0.6"
                                                       VerticalAlignment="Center"
                                                       IsVisible="{Binding !IsSearching}" />
                                        <fa:ProgressRing Width="16"
                                                         Height="16"
                                                         IsVisible="{Binding IsSearching}"
                                                         IsIndeterminate="True" />
                                    </Panel>

                                    <!-- Search Box -->
                                    <TextBox Grid.Column="1"
                                             Text="{Binding SearchQuery}"
                                             Watermark="Search by title, artist, or album..."
                                             BorderThickness="0"
                                             Background="Transparent"
                                             VerticalAlignment="Center"
                                             VerticalContentAlignment="Center"
                                             Padding="0">
                                        <TextBox.Styles>
                                            <Style Selector="TextBox:focus /template/ Border#PART_BorderElement">
                                                <Setter Property="Background" Value="Transparent" />
                                                <Setter Property="BorderThickness" Value="0" />
                                            </Style>
                                        </TextBox.Styles>
                                    </TextBox>

                                    <!-- Clear Button -->
                                    <Button Grid.Column="2"
                                            Command="{Binding ClearSearchCommand}"
                                            IsVisible="{Binding !!SearchQuery.Length}"
                                            Width="24"
                                            Height="24"
                                            Padding="0"
                                            Background="Transparent"
                                            ToolTip.Tip="Clear Search">
                                        <ic:SymbolIcon Symbol="Dismiss" FontSize="14" />
                                    </Button>
                                </Grid>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Loading Indicator -->
                    <fa:ProgressRing Grid.Row="1"
                                     IsVisible="{Binding IsLoadingSongs}"
                                     Width="48"
                                     Height="48"
                                     HorizontalAlignment="Center"
                                     VerticalAlignment="Center"
                                     IsIndeterminate="True" />

                    <!-- Songs List -->
                    <ScrollViewer Grid.Row="1"
                                  IsVisible="{Binding !IsLoadingSongs}"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled">
                        <ItemsControl ItemsSource="{Binding DisplayedSongs}"
                                      Padding="0,0,8,0">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <VirtualizingStackPanel />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>

                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <!-- Song Card (same as before) -->
                                    <Border Padding="8,6"
                                            Margin="0,2"
                                            CornerRadius="6"
                                            Background="{StaticResource SongCardBackground}"
                                            Classes="song-item"
                                            Cursor="Hand"
                                            Tapped="SongElement_OnTapped">
                                        <Border.ContextFlyout>
                                            <MenuFlyout>
                                                <MenuItem Header="Play"
                                                          Command="{Binding DataContext.PlaySongCommand, ElementName=LibraryRoot}"
                                                          CommandParameter="{Binding}">
                                                    <MenuItem.Icon>
                                                        <ic:SymbolIcon Symbol="Play" />
                                                    </MenuItem.Icon>
                                                </MenuItem>

                                                <MenuItem Header="Add to Queue"
                                                          Command="{Binding DataContext.EnqueueSongCommand, ElementName=LibraryRoot}"
                                                          CommandParameter="{Binding}">
                                                    <MenuItem.Icon>
                                                        <ic:SymbolIcon Symbol="Add" />
                                                    </MenuItem.Icon>
                                                </MenuItem>

                                                <Separator />

                                                <MenuItem Header="Add to Playlist"
                                                          Command="{Binding DataContext.AddSongToPlaylistCommand, ElementName=LibraryRoot}"
                                                          CommandParameter="{Binding}">
                                                    <MenuItem.Icon>
                                                        <ic:SymbolIcon Symbol="List" />
                                                    </MenuItem.Icon>
                                                </MenuItem>

                                                <MenuItem Header="Create Playlist with Song"
                                                          Command="{Binding DataContext.CreatePlaylistWithSongCommand, ElementName=LibraryRoot}"
                                                          CommandParameter="{Binding}">
                                                    <MenuItem.Icon>
                                                        <ic:SymbolIcon Symbol="AlbumAdd" />
                                                    </MenuItem.Icon>
                                                </MenuItem>

                                                <Separator />

                                                <MenuItem Header="Remove from Library"
                                                          Command="{Binding DataContext.RemoveSongCommand, ElementName=LibraryRoot}"
                                                          CommandParameter="{Binding}">
                                                    <MenuItem.Icon>
                                                        <ic:SymbolIcon Symbol="Delete" Foreground="Red" />
                                                    </MenuItem.Icon>
                                                </MenuItem>
                                            </MenuFlyout>
                                        </Border.ContextFlyout>

                                        <Grid ColumnDefinitions="Auto,*,Auto" Background="Transparent">
                                            <!-- Music Icon -->
                                            <Border Width="32" Height="32"
                                                    CornerRadius="4"
                                                    Background="#FF2D2D2D"
                                                    Margin="0,0,12,0">
                                                <ic:SymbolIcon Symbol="MusicNote2"
                                                               FontSize="16"
                                                               Opacity="0.5"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center" />
                                            </Border>

                                            <!-- Title / Artist -->
                                            <StackPanel Grid.Column="1"
                                                        Orientation="Vertical"
                                                        VerticalAlignment="Center"
                                                        Margin="0,0,8,0">
                                                <ToolTip.Tip>
                                                    <TextBlock Text="{Binding FilePath}" />
                                                </ToolTip.Tip>
                                                <TextBlock Text="{Binding Title}" Classes="song-title" />
                                                <TextBlock Text="{Binding Artist}" Classes="song-artist" />
                                            </StackPanel>

                                            <!-- Duration -->
                                            <TextBlock Grid.Column="2"
                                                       Text="{Binding Duration, Converter={StaticResource TimeConverter}}"
                                                       Classes="song-duration" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>

                <!-- Playlists View -->
                <Grid IsVisible="{Binding ShowPlaylists}"
                      RowDefinitions="Auto,*">
                    <Grid.Transitions>
                        <Transitions>
                            <DoubleTransition Property="Opacity" Duration="0:0:0.3" />
                            <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.3" Easing="CubicEaseOut" />
                        </Transitions>
                    </Grid.Transitions>
                    <Grid.Styles>
                        <Style Selector="Grid">
                            <Setter Property="Opacity" Value="0" />
                            <Setter Property="RenderTransform" Value="translateY(20px)" />
                        </Style>
                        <Style Selector="Grid[IsVisible=true]">
                            <Setter Property="Opacity" Value="1" />
                            <Setter Property="RenderTransform" Value="translateY(0px)" />
                        </Style>
                    </Grid.Styles>

                    <!-- Playlists Header -->
                    <Border Grid.Row="0"
                            Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                            CornerRadius="10"
                            Padding="14"
                            Margin="0,8,0,12">
                        <DockPanel LastChildFill="False">
                            <StackPanel DockPanel.Dock="Left" Orientation="Horizontal" Spacing="12">
                                <TextBlock Text="Playlists" Classes="playlist-header" />

                                <!-- Playlists Statistics Badge -->
                                <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                        CornerRadius="12"
                                        Padding="12,6"
                                        VerticalAlignment="Center">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <Border Width="24" Height="24"
                                                CornerRadius="12"
                                                Background="#22FB923C"
                                                VerticalAlignment="Center">
                                            <ic:SymbolIcon Symbol="List"
                                                           FontSize="12"
                                                           Foreground="#FFFB923C"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center" />
                                        </Border>
                                        <TextBlock VerticalAlignment="Center" FontSize="13">
                                            <Run Text="{Binding Playlists.Count}" FontWeight="Bold" />
                                            <Run Text="playlists" />
                                        </TextBlock>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <Button DockPanel.Dock="Right"
                                    Command="{Binding CreatePlaylistCommand}"
                                    MaxWidth="44"
                                    ToolTip.Tip="Create New Playlist">
                                <ic:SymbolIcon Symbol="Add" />
                            </Button>
                        </DockPanel>
                    </Border>

                    <!-- Playlists Grid -->
                    <ScrollViewer Grid.Row="1"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled">
                        <ItemsControl ItemsSource="{Binding Playlists}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>

                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <!-- Playlist Card -->
                                    <Border Width="200"
                                            Height="260"
                                            Margin="8"
                                            CornerRadius="12"
                                            Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                                            BoxShadow="0 4 12 #22000000"
                                            Cursor="Hand">
                                        <Border.Transitions>
                                            <Transitions>
                                                <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.2" />
                                            </Transitions>
                                        </Border.Transitions>
                                        <Border.Styles>
                                            <Style Selector="Border:pointerover">
                                                <Setter Property="RenderTransform" Value="scale(1.02)" />
                                                <Setter Property="BoxShadow" Value="0 6 20 #44000000" />
                                            </Style>
                                        </Border.Styles>

                                        <Grid RowDefinitions="Auto,*">
                                            <!-- Playlist Artwork -->
                                            <Border Grid.Row="0"
                                                    Width="200"
                                                    Height="200"
                                                    CornerRadius="12 12 0 0"
                                                    ClipToBounds="True">
                                                <Button Background="Transparent"
                                                        BorderThickness="0"
                                                        Padding="0"
                                                        HorizontalAlignment="Stretch"
                                                        VerticalAlignment="Stretch"
                                                        Command="{Binding DataContext.OpenPlaylistDetailsCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                        CommandParameter="{Binding}">
                                                    <Grid>
                                                        <!-- Artwork -->
                                                        <controls:PlaylistArtwork
                                                            Artwork="{Binding Artwork}"
                                                            CustomArtwork="{Binding CustomArtwork}"
                                                            Width="200"
                                                            Height="200">
                                                            <controls:PlaylistArtwork.ContextFlyout>
                                                                <MenuFlyout>
                                                                    <MenuItem Header="Play"
                                                                              Command="{Binding DataContext.PlayPlaylistCommand, ElementName=LibraryRoot}"
                                                                              CommandParameter="{Binding}">
                                                                        <MenuItem.Icon>
                                                                            <ic:SymbolIcon Symbol="Play" />
                                                                        </MenuItem.Icon>
                                                                    </MenuItem>

                                                                    <MenuItem Header="Shuffle"
                                                                              Command="{Binding DataContext.PlayPlaylistShuffledCommand, ElementName=LibraryRoot}"
                                                                              CommandParameter="{Binding}">
                                                                        <MenuItem.Icon>
                                                                            <ic:SymbolIcon Symbol="ArrowShuffle" />
                                                                        </MenuItem.Icon>
                                                                    </MenuItem>

                                                                    <Separator />

                                                                    <MenuItem Header="View Songs"
                                                                              Command="{Binding DataContext.OpenPlaylistDetailsCommand, ElementName=LibraryRoot}"
                                                                              CommandParameter="{Binding}">
                                                                        <MenuItem.Icon>
                                                                            <ic:SymbolIcon Symbol="List" />
                                                                        </MenuItem.Icon>
                                                                    </MenuItem>

                                                                    <Separator />

                                                                    <MenuItem Header="Rename"
                                                                              Command="{Binding DataContext.RenamePlaylistCommand, ElementName=LibraryRoot}"
                                                                              CommandParameter="{Binding}">
                                                                        <MenuItem.Icon>
                                                                            <ic:SymbolIcon Symbol="Rename" />
                                                                        </MenuItem.Icon>
                                                                    </MenuItem>

                                                                    <MenuItem Header="Change Artwork"
                                                                              Command="{Binding DataContext.ChangePlaylistArtworkCommand, ElementName=LibraryRoot}"
                                                                              CommandParameter="{Binding}">
                                                                        <MenuItem.Icon>
                                                                            <ic:SymbolIcon Symbol="Image" />
                                                                        </MenuItem.Icon>
                                                                    </MenuItem>

                                                                    <MenuItem Header="Remove Custom Artwork"
                                                                              Command="{Binding DataContext.RemovePlaylistArtworkCommand, ElementName=LibraryRoot}"
                                                                              CommandParameter="{Binding}"
                                                                              IsVisible="{Binding !!CustomArtwork}">
                                                                        <MenuItem.Icon>
                                                                            <ic:SymbolIcon Symbol="Delete" Foreground="Orange" />
                                                                        </MenuItem.Icon>
                                                                    </MenuItem>

                                                                    <Separator />

                                                                    <MenuItem Header="Delete Playlist"
                                                                              Command="{Binding DataContext.DeletePlaylistCommand, ElementName=LibraryRoot}"
                                                                              CommandParameter="{Binding}">
                                                                        <MenuItem.Icon>
                                                                            <ic:SymbolIcon Symbol="Delete" Foreground="Red" />
                                                                        </MenuItem.Icon>
                                                                    </MenuItem>
                                                                </MenuFlyout>
                                                            </controls:PlaylistArtwork.ContextFlyout>
                                                        </controls:PlaylistArtwork>

                                                        <!-- Hover Overlay -->
                                                        <Border Name="HoverOverlay"
                                                                Background="#AA000000"
                                                                Opacity="0"
                                                                IsHitTestVisible="False">
                                                            <Border.Transitions>
                                                                <Transitions>
                                                                    <DoubleTransition Property="Opacity" Duration="0:0:0.2" />
                                                                </Transitions>
                                                            </Border.Transitions>
                                                        </Border>

                                                        <!-- Play Button (shows on hover) -->
                                                        <ic:SymbolIcon Symbol="PlayCircle"
                                                                       FontSize="48"
                                                                       Foreground="White"
                                                                       HorizontalAlignment="Center"
                                                                       VerticalAlignment="Center"
                                                                       Name="PlayIcon"
                                                                       Opacity="0"
                                                                       IsHitTestVisible="False">
                                                            <ic:SymbolIcon.Transitions>
                                                                <Transitions>
                                                                    <DoubleTransition Property="Opacity" Duration="0:0:0.2" />
                                                                </Transitions>
                                                            </ic:SymbolIcon.Transitions>
                                                        </ic:SymbolIcon>
                                                    </Grid>

                                                    <Button.Styles>
                                                        <Style Selector="Button:pointerover /template/ ContentPresenter">
                                                            <Style Selector="^ Border#HoverOverlay">
                                                                <Setter Property="Opacity" Value="1" />
                                                            </Style>
                                                            <Style Selector="^ ic|SymbolIcon#PlayIcon">
                                                                <Setter Property="Opacity" Value="1" />
                                                            </Style>
                                                        </Style>
                                                    </Button.Styles>
                                                </Button>
                                            </Border>

                                            <!-- Playlist Info -->
                                            <Border Grid.Row="1" Padding="12,8,12,12">
                                                <Grid RowDefinitions="Auto,Auto">
                                                    <!-- Name -->
                                                    <TextBlock Grid.Row="0"
                                                               Text="{Binding Name}"
                                                               FontWeight="SemiBold"
                                                               FontSize="14"
                                                               TextTrimming="CharacterEllipsis"
                                                               ToolTip.Tip="{Binding Name}" />

                                                    <!-- Metadata -->
                                                    <Grid Grid.Row="1" ColumnDefinitions="*,Auto" Margin="0,2,0,0">
                                                        <TextBlock Grid.Column="0" FontSize="12" Opacity="0.6">
                                                            <Run Text="{Binding SongCount}" />
                                                            <Run Text="songs" />
                                                        </TextBlock>
                                                        <TextBlock Grid.Column="1"
                                                                   FontSize="12"
                                                                   Opacity="0.6"
                                                                   IsVisible="{Binding !!TotalDuration}"
                                                                   Text="{Binding TotalDuration, Converter={StaticResource TimeConverter}}" />
                                                    </Grid>
                                                </Grid>
                                            </Border>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </Grid>
        </Grid>

        <!-- Playlist Details Overlay -->
        <Grid IsVisible="{Binding IsPlaylistDetailsOpen}"
              ZIndex="100">
            <Grid.Transitions>
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.2" />
                </Transitions>
            </Grid.Transitions>

            <!-- Blurred Background Overlay -->
            <Border Background="#AA000000">
                <Border.Effect>
                    <BlurEffect Radius="10" />
                </Border.Effect>
            </Border>

            <!-- Click outside to close -->
            <Border Background="Transparent"
                    PointerPressed="CloseOverlay_OnPointerPressed" />

            <!-- Details Panel -->
            <Border Background="{DynamicResource ApplicationPageBackgroundThemeBrush}"
                    CornerRadius="12"
                    Margin="40"
                    MaxWidth="900"
                    MaxHeight="600"
                    BoxShadow="0 8 32 0.3 Black"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                <Grid RowDefinitions="Auto,*,Auto">
                    <!-- Header -->
                    <Border Grid.Row="0"
                            Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                            CornerRadius="12 12 0 0"
                            Padding="20">
                        <Grid ColumnDefinitions="Auto,*,Auto">
                            <!-- Artwork -->
                            <controls:PlaylistArtwork
                                Grid.Column="0"
                                Artwork="{Binding SelectedPlaylist.Artwork}"
                                CustomArtwork="{Binding SelectedPlaylist.CustomArtwork}"
                                Width="80"
                                Height="80"
                                Margin="0,0,16,0">
                                <controls:PlaylistArtwork.ContextFlyout>
                                    <MenuFlyout>
                                        <MenuItem Header="Change Artwork"
                                                  Command="{Binding ChangePlaylistArtworkCommand}"
                                                  CommandParameter="{Binding SelectedPlaylist}">
                                            <MenuItem.Icon>
                                                <ic:SymbolIcon Symbol="Image" />
                                            </MenuItem.Icon>
                                        </MenuItem>

                                        <MenuItem Header="Remove Custom Artwork"
                                                  Command="{Binding RemovePlaylistArtworkCommand}"
                                                  CommandParameter="{Binding SelectedPlaylist}"
                                                  IsVisible="{Binding SelectedPlaylist.CustomArtwork, Converter={x:Static ObjectConverters.IsNotNull}}">
                                            <MenuItem.Icon>
                                                <ic:SymbolIcon Symbol="Delete" Foreground="Orange" />
                                            </MenuItem.Icon>
                                        </MenuItem>
                                    </MenuFlyout>
                                </controls:PlaylistArtwork.ContextFlyout>
                            </controls:PlaylistArtwork>

                            <!-- Info -->
                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock Text="{Binding SelectedPlaylist.Name}"
                                           FontSize="24"
                                           FontWeight="Bold" />
                                <!-- Metadata -->
                                <StackPanel Orientation="Horizontal" Spacing="0" Margin="0,4,0,0">
                                    <TextBlock Opacity="0.7">
                                        <Run Text="{Binding SelectedPlaylist.SongCount}" />
                                        <Run Text="songs" />
                                    </TextBlock>
                                    <TextBlock Opacity="0.7" IsVisible="{Binding !!SelectedPlaylist.TotalDuration}">
                                        <Run Text=" • " />
                                        <Run Text="{Binding SelectedPlaylist.TotalDuration, Converter={StaticResource TimeConverter}}" />
                                    </TextBlock>
                                    <TextBlock Opacity="0.7">
                                        <Run Text=" • " />
                                        <Run Text="{Binding SelectedPlaylist.UpdatedAt, StringFormat='Updated {0:MMM d, yyyy}'}" />
                                    </TextBlock>
                                </StackPanel>
                            </StackPanel>

                            <!-- Close Button -->
                            <Button Grid.Column="2"
                                    Command="{Binding ClosePlaylistDetailsCommand}"
                                    VerticalAlignment="Top"
                                    Width="32"
                                    Height="32"
                                    Padding="0"
                                    Background="Transparent"
                                    ToolTip.Tip="Close">
                                <ic:SymbolIcon Symbol="Dismiss" />
                            </Button>
                        </Grid>
                    </Border>

                    <!-- Songs List -->
                    <ScrollViewer Grid.Row="1"
                                  Padding="20"
                                  VerticalScrollBarVisibility="Auto">
                        <Grid>
                            <ItemsControl ItemsSource="{Binding SelectedPlaylist.PlaylistSongs}"
                                          IsVisible="{Binding !!SelectedPlaylist.PlaylistSongs.Count}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <!-- Song Card -->
                                        <Border Padding="8,6"
                                                Margin="0,2"
                                                CornerRadius="6"
                                                Background="{StaticResource SongCardBackground}"
                                                Classes="song-item"
                                                Cursor="Hand"
                                                Tapped="SongElement_OnTapped">
                                            <Border.ContextFlyout>
                                                <MenuFlyout>
                                                    <MenuItem Header="Play"
                                                              Command="{Binding DataContext.PlaySongCommand, ElementName=LibraryRoot}"
                                                              CommandParameter="{Binding}">
                                                        <MenuItem.Icon>
                                                            <ic:SymbolIcon Symbol="Play" />
                                                        </MenuItem.Icon>
                                                    </MenuItem>

                                                    <MenuItem Header="Add to Queue"
                                                              Command="{Binding DataContext.EnqueueSongCommand, ElementName=LibraryRoot}"
                                                              CommandParameter="{Binding}">
                                                        <MenuItem.Icon>
                                                            <ic:SymbolIcon Symbol="Add" />
                                                        </MenuItem.Icon>
                                                    </MenuItem>

                                                    <Separator />

                                                    <MenuItem Header="Move Up"
                                                              Command="{Binding DataContext.MovePlaylistSongUpCommand, ElementName=LibraryRoot}"
                                                              CommandParameter="{Binding}">
                                                        <MenuItem.Icon>
                                                            <ic:SymbolIcon Symbol="ArrowUp" />
                                                        </MenuItem.Icon>
                                                    </MenuItem>

                                                    <MenuItem Header="Move Down"
                                                              Command="{Binding DataContext.MovePlaylistSongDownCommand, ElementName=LibraryRoot}"
                                                              CommandParameter="{Binding}">
                                                        <MenuItem.Icon>
                                                            <ic:SymbolIcon Symbol="ArrowDown" />
                                                        </MenuItem.Icon>
                                                    </MenuItem>

                                                    <Separator />

                                                    <MenuItem Header="Remove from Playlist"
                                                              Command="{Binding DataContext.RemoveFromPlaylistCommand, ElementName=LibraryRoot}"
                                                              CommandParameter="{Binding}">
                                                        <MenuItem.Icon>
                                                            <ic:SymbolIcon Symbol="Delete" Foreground="Orange" />
                                                        </MenuItem.Icon>
                                                    </MenuItem>
                                                </MenuFlyout>
                                            </Border.ContextFlyout>

                                            <Grid ColumnDefinitions="Auto,*,Auto" Background="Transparent">
                                                <!-- Music Icon -->
                                                <Border Width="32" Height="32"
                                                        CornerRadius="4"
                                                        Background="#FF2D2D2D"
                                                        Margin="0,0,12,0">
                                                    <ic:SymbolIcon Symbol="MusicNote2"
                                                                   FontSize="16"
                                                                   Opacity="0.5"
                                                                   HorizontalAlignment="Center"
                                                                   VerticalAlignment="Center" />
                                                </Border>

                                                <!-- Title / Artist -->
                                                <StackPanel Grid.Column="1"
                                                            Orientation="Vertical"
                                                            VerticalAlignment="Center"
                                                            Margin="0,0,8,0">
                                                    <TextBlock Text="{Binding Title}" Classes="song-title" />
                                                    <TextBlock Text="{Binding Artist}" Classes="song-artist" />
                                                </StackPanel>

                                                <!-- Duration -->
                                                <TextBlock Grid.Column="2"
                                                           Text="{Binding Duration, Converter={StaticResource TimeConverter}}"
                                                           Classes="song-duration" />
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- Empty State -->
                            <Border IsVisible="{Binding !SelectedPlaylist.PlaylistSongs.Count}"
                                    Padding="48"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center">
                                <StackPanel Spacing="12" HorizontalAlignment="Center">
                                    <ic:SymbolIcon Symbol="MusicNote2"
                                                   FontSize="48"
                                                   Opacity="0.3"
                                                   HorizontalAlignment="Center" />
                                    <TextBlock Text="No songs in this playlist"
                                               FontSize="16"
                                               Opacity="0.6"
                                               HorizontalAlignment="Center" />
                                    <TextBlock Text="Add songs from your library to get started"
                                               FontSize="14"
                                               Opacity="0.5"
                                               HorizontalAlignment="Center" />
                                </StackPanel>
                            </Border>
                        </Grid>
                    </ScrollViewer>

                    <!-- Actions Bar -->
                    <Border Grid.Row="2"
                            Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                            CornerRadius="0 0 12 12"
                            Padding="20">
                        <Grid ColumnDefinitions="*,Auto">
                            <!-- Play Actions -->
                            <StackPanel Grid.Column="0"
                                        Orientation="Horizontal"
                                        Spacing="12">
                                <Button Command="{Binding PlayPlaylistCommand}"
                                        CommandParameter="{Binding SelectedPlaylist}"
                                        IsEnabled="{Binding !!SelectedPlaylist.SongCount}">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <ic:SymbolIcon Symbol="Play" />
                                        <TextBlock Text="Play All" />
                                    </StackPanel>
                                </Button>

                                <Button Command="{Binding PlayPlaylistShuffledCommand}"
                                        CommandParameter="{Binding SelectedPlaylist}"
                                        IsEnabled="{Binding !!SelectedPlaylist.SongCount}">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <ic:SymbolIcon Symbol="ArrowShuffle" />
                                        <TextBlock Text="Shuffle" />
                                    </StackPanel>
                                </Button>
                            </StackPanel>

                            <!-- Management Actions -->
                            <StackPanel Grid.Column="1"
                                        Orientation="Horizontal"
                                        Spacing="12">
                                <Button Command="{Binding RenamePlaylistCommand}"
                                        CommandParameter="{Binding SelectedPlaylist}">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <ic:SymbolIcon Symbol="Rename" />
                                        <TextBlock Text="Rename" />
                                    </StackPanel>
                                </Button>

                                <Button Command="{Binding DeletePlaylistFromDetailsCommand}"
                                        CommandParameter="{Binding SelectedPlaylist}">
                                    <Button.Styles>
                                        <Style Selector="Button">
                                            <Setter Property="Background" Value="#44FF0000" />
                                        </Style>
                                        <Style Selector="Button:pointerover /template/ ContentPresenter">
                                            <Setter Property="Background" Value="#66FF0000" />
                                        </Style>
                                    </Button.Styles>
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <ic:SymbolIcon Symbol="Delete" Foreground="#FFCCCC" />
                                        <TextBlock Text="Delete Playlist" Foreground="#FFCCCC" />
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>